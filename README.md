# HumanitZ Save Editor

A Python toolkit for reading, analyzing, and editing HumanitZ dedicated server save files.
Built through reverse-engineering the UE4 4.27 GVAS save format and the encrypted Pak v11 archive.

---

## Quick Start

```powershell
# 1. Install the only dependency
pip install pycryptodome

# 2. Place your server's PlayerIDMapped.txt in the project root
#    (found in your server's Saved/SaveGames/ folder)

# 3. Analyze a save file
python src/read_save.py "path\to\Save_MAZADedicatedSave1.sav"

# 4. View/edit player stats and profession
python src/edit_stats.py "path\to\Save_MAZADedicatedSave1.sav"

# 5. Change a player's profession (standalone alternative)
python src/edit_profession.py "path\to\Save_MAZADedicatedSave1.sav"
```

---

## Requirements

- **Python 3.10+** (tested with 3.13)
- **pycryptodome** — for AES-256-ECB decryption of the pak index
  ```
  pip install pycryptodome
  ```

---

## Setup

### Player ID File

All scripts require a `PlayerIDMapped.txt` file to map SteamID64 values to player names.
This file is generated by the HumanitZ dedicated server.

**Where to find it:** In your server's `Saved/SaveGames/` directory.

**Format:**
```
76561198142478391_+_|00028ce6e7d54af2968d8aff2e694375@0xAnakin
76561198108344973_+_|0002462cecc14620a256442159aac2fe@raybanme
```

Place the file in the project root directory (default location), or pass
`--players path\to\PlayerIDMapped.txt` to any script.

### Game Installation

Edit `GAME_DIR` in `src/config.py` to match your HumanitZ installation path.
This is only needed for `pak_reader.py` and `extract_enums.py`.

---

## File Overview

```
HumanitZ_SaveEditor/
├── src/                       # Source code
│   ├── __init__.py
│   ├── config.py              # Paths, AES key, profession enum map, format constants
│   ├── utils.py               # Core utilities: GVAS parser, AES, binary search, player loading
│   ├── read_save.py           # Analyze a save file (read-only)
│   ├── edit_profession.py     # Interactive profession editor
│   ├── edit_stats.py          # Player stats & profession editor (recommended)
│   ├── scan_properties.py     # Generic property/string scanner & hex dump tool
│   ├── pak_reader.py          # Pak file index reader and file extractor
│   └── extract_enums.py       # Extract Enum_Professions from pak, parse mapping
├── PlayerIDMapped.txt         # Player SteamID -> name mapping (from your server)
└── README.md
```

---

## Scripts

### `read_save.py` — Save Analyzer

Reads a save file and produces a detailed report.

```powershell
python src/read_save.py <save_file> [--players <PlayerIDMapped.txt>]
```

**Output includes:**
- File info, GVAS header, engine version, save class
- Which players are present in the save (by SteamID occurrence count)
- Every profession entry found, tagged with player name and context
  (active `StartingPerk` or `UnlockedProfessionArr`)
- Per-player summary
- Reference table of all professions

---

### `edit_stats.py` — Player Stats & Profession Editor (Recommended)

The main editing tool. View and edit Level, XP, Skill Points, and Profession.

```powershell
python src/edit_stats.py <save_file> [--players <PlayerIDMapped.txt>]
```

**Features:**
- Finds all players automatically via SteamID struct boundaries
- Displays current stats and profession for every player
- Edit individual stats, batch-edit (Level + Skill Points + XP), or change profession
- Profession changes automatically update the unlocked professions array
- Stat edits are fixed-size in-place overwrites — file size never changes
- Creates a timestamped backup before the first modification

**Editable properties:**

| Property | Type | Description |
|----------|------|-------------|
| Profession | ByteProperty (Enum) | Active profession |
| Level | IntProperty | Character level |
| Skill Points | IntProperty | Available/unspent skill points |
| XP Gained | IntProperty | Total lifetime XP earned |
| Required XP | FloatProperty | XP needed for next level |
| Current XP | FloatProperty | Progress towards next level |

---

### `edit_profession.py` — Profession Changer

Standalone profession editor (simpler alternative to `edit_stats.py`).

```powershell
python src/edit_profession.py <save_file> [--players <PlayerIDMapped.txt>]
```

**Safety levels:**

| Swap Type | Safety | Example |
|-----------|--------|---------|
| Same digit count (0–9 or 10–17) | SAFE — identical byte lengths | NE14 → NE13 |
| Cross digit count (0–9 ↔ 10–17) | OK — length prefix updated automatically | NE3 → NE14 |

---

### `scan_properties.py` — Generic Property Scanner

Search save files for strings, count UE4 property types, view headers, or hex dump.

```powershell
python src/scan_properties.py <save_file> --header
python src/scan_properties.py <save_file> --properties
python src/scan_properties.py <save_file> --search Health
python src/scan_properties.py <save_file> --hex 0x007B3200
```

---

### `pak_reader.py` — Pak File Reader/Extractor

Read the encrypted UE4 Pak v11 index and list, search, or extract files.

```powershell
python src/pak_reader.py --info
python src/pak_reader.py --list
python src/pak_reader.py --search "Enum_Professions"
python src/pak_reader.py --extract "Enum_Professions" --output ./extracted
```

---

### `extract_enums.py` — Enum Extractor

Extract `Enum_Professions` from the pak and parse its display name mapping.
Run after a game update to check for new professions.

```powershell
python src/extract_enums.py --output ./extracted
```

Outputs the correct NewEnumerator → Display Name mapping and a ready-to-paste
Python dict for updating `src/config.py`.

---

## Profession Enum Map

| NE# | Display Name |
|-----|-------------|
| 0 | Unemployed |
| 1 | AmateurBoxer |
| 2 | Farmer |
| 3 | Mechanic |
| 4 | JuniorBiodiesel Researcher |
| 5 | EmergencyMedicalTechnician |
| 6 | ApprenticeGunsmith |
| 7 | FoodServiceWorker |
| 8 | SundayFisherman |
| 9 | CarSalesman |
| 10 | Outdoorsman |
| 12 | Chemist |
| 13 | EMT |
| 14 | MilitaryVet |
| 15 | Thief |
| 16 | FireFighter |
| 17 | ElectricalEngineer |

**Note:** NewEnumerator11 does not exist (gap in the game's enum numbering).

---

## Save File Locations

### Dedicated Server
```
<ServerRoot>\HumanitZ\Saved\SaveGames\
├── PlayerIDMapped.txt                    # Player SteamID -> name mapping
├── DedSave_ResGlobal.sav                 # Global resource/settings
├── Save_ClanData.sav                     # Clan data
└── SaveList\Default\
    ├── Save_<Name>.sav                   # Main save with all player data
    └── <Name>_Foliage.sav                # Foliage state
```

### Local (Single Player)
```
%LOCALAPPDATA%\HumanitZ\Saved\SaveGames\
└── SaveList\Default\
    ├── Save_<Name>.sav
    ├── <Name>_CharPreview.sav
    └── <Name>_Foliage.sav
```

---

## Troubleshooting

| Problem | Solution |
|---------|----------|
| `pycryptodome not found` | `pip install pycryptodome` (uninstall `pycrypto` first if present) |
| `Player ID file not found` | Copy `PlayerIDMapped.txt` from your server, or use `--players path` |
| No profession entries found | Player may not have selected a profession; try `python src/scan_properties.py --search Profession` |
| Game update changed professions | Run `python src/extract_enums.py` to re-extract the mapping |
| Save corrupted after editing | Restore the automatic backup (`*.backup_YYYYMMDD_HHMMSS`) |
